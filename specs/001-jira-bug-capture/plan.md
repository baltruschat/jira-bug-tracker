# Implementation Plan: Jira Bug Capture Chrome Extension

**Branch**: `001-jira-bug-capture` | **Date**: 2025-02-10 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-jira-bug-capture/spec.md`

## Summary

Build a Chrome Extension (Manifest V3) that captures comprehensive
bug diagnostic data (screenshot, console logs, network requests,
browser environment, page context) and submits it as a Jira Cloud
issue via OAuth 2.0 (3LO). Supports multiple Jira sites, screenshot
annotation, and configurable capture preferences. All diagnostic
data is embedded in the Jira issue description using ADF tables
and code blocks.

## Technical Context

**Language/Version**: TypeScript 5.x (strict mode)
**Framework**: WXT (Web Extension Tools) with Vite
**Primary Dependencies**: WXT, @webext-core/fake-browser (testing)
**Storage**: chrome.storage.local (settings, connection metadata),
  chrome.storage.session (OAuth tokens, capture buffers)
**Testing**: Vitest (unit/integration) + Playwright (E2E)
**Target Platform**: Chrome Extension (Manifest V3), Chrome 120+
**Project Type**: Single project (Chrome Extension)
**Performance Goals**: <2s capture, <500ms popup render, <50ms page overhead
**Constraints**: No backend server; all logic client-side;
  client_secret embedded in extension (accepted trade-off)
**Scale/Scope**: Single-user extension, 1-N Jira sites,
  up to 1,000 console entries and 500 network requests per capture

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Sentry-Grade Data Completeness | PASS | All 6 data categories covered: user data, viewport, network, console, screenshot, page context |
| II. Secure OAuth Authentication | PASS | OAuth 2.0 (3LO) via chrome.identity.launchWebAuthFlow. Tokens in chrome.storage.session. Rotating refresh tokens. Scopes: read:jira-work, write:jira-work, offline_access |
| III. Privacy & Data Security | PASS | Redaction service strips auth headers, cookies, password fields. Bodies truncated to configurable max. No data leaves browser until explicit user confirmation. HTTPS only (api.atlassian.com) |
| IV. Minimal User Friction | PASS | One-click capture via icon or shortcut. <2s capture. Review before submit. Annotation tools. Direct Jira issue link on success |
| V. Chrome Extension Standards | PASS | Manifest V3 via WXT. Least-privilege permissions. Clean separation: content scripts, service worker, popup. chrome.storage API only |

**Post-Phase 1 Re-check**: PASS — all design artifacts align with
constitution principles. No violations to justify.

## Project Structure

### Documentation (this feature)

```text
specs/001-jira-bug-capture/
├── plan.md
├── research.md
├── data-model.md
├── quickstart.md
├── contracts/
│   ├── jira-api.md
│   └── internal-messaging.md
└── tasks.md             # Generated by /speckit.tasks
```

### Source Code (repository root)

```text
entrypoints/
├── popup/
│   ├── index.html          # Popup HTML shell
│   ├── main.ts             # Popup entry point
│   ├── style.scss          # Popup styles
│   ├── App.ts              # Main popup application logic
│   ├── views/
│   │   ├── ConnectView.ts      # Jira connection management
│   │   ├── CaptureView.ts      # Capture preview & review
│   │   ├── ReportFormView.ts   # Bug report form (title, project, type)
│   │   ├── AnnotationView.ts   # Screenshot annotation editor
│   │   ├── SuccessView.ts      # Submission success with issue link
│   │   └── SettingsView.ts     # Extension settings
│   └── components/
│       ├── SiteSelector.ts     # Jira site dropdown
│       ├── ProjectSelector.ts  # Project dropdown with search
│       ├── IssueTypeSelector.ts # Issue type dropdown
│       ├── ConsolePreview.ts   # Console entries preview
│       ├── NetworkPreview.ts   # Network requests preview
│       └── ScreenshotPreview.ts # Screenshot thumbnail
├── background.ts           # Service worker entry
├── content.ts              # Content script - ISOLATED world
└── injected.ts             # Content script - MAIN world

src/
├── services/
│   ├── auth.ts             # OAuth flow, token refresh, multi-site
│   ├── capture.ts          # Orchestrates full capture sequence
│   ├── jira-api.ts         # Jira REST API client (all endpoints)
│   ├── redaction.ts        # Sensitive data redaction rules
│   ├── adf-builder.ts      # Builds ADF document for issue description
│   ├── console-collector.ts # Console entry buffering & retrieval
│   ├── network-collector.ts # Network request tracking & correlation
│   └── screenshot.ts       # Screenshot capture, compression, annotation
├── models/
│   ├── types.ts            # All TypeScript interfaces/types
│   ├── bug-report.ts       # BugReport entity logic
│   ├── connection.ts       # JiraConnection entity logic
│   └── settings.ts         # ExtensionSettings defaults & validation
├── storage/
│   └── chrome-storage.ts   # Typed chrome.storage wrapper
└── utils/
    ├── environment.ts      # Browser/OS/viewport detection
    ├── crypto.ts           # State parameter generation (CSRF)
    └── constants.ts        # OAuth URLs, default settings, limits

tests/
├── unit/
│   ├── services/
│   │   ├── auth.test.ts
│   │   ├── redaction.test.ts
│   │   ├── adf-builder.test.ts
│   │   ├── capture.test.ts
│   │   ├── console-collector.test.ts
│   │   └── network-collector.test.ts
│   ├── models/
│   │   ├── bug-report.test.ts
│   │   ├── connection.test.ts
│   │   └── settings.test.ts
│   └── storage/
│       └── chrome-storage.test.ts
├── integration/
│   ├── jira-api.test.ts
│   ├── capture-flow.test.ts
│   └── auth-flow.test.ts
└── e2e/
    ├── fixtures/
    │   └── test-page.html
    ├── connect.spec.ts
    ├── capture.spec.ts
    ├── submit.spec.ts
    └── settings.spec.ts
```

**Structure Decision**: Single-project Chrome Extension structure.
WXT's file-based entrypoint system uses `entrypoints/` at the root.
Shared business logic lives in `src/`. Tests mirror the source
structure under `tests/`.

## Complexity Tracking

No constitution violations — this section is empty.
